
{% extends 'base/base.html' %}
{% load i18n %}

{% block title %}{% trans "Error Analytics" %}{% endblock %}

{% block extra_head %}
<style>
  .dashboard-panel {
    background: rgba(15, 23, 42, 0.48);
    border: 1px solid rgba(148, 163, 184, 0.18);
    border-radius: var(--radius-lg);
    padding: clamp(var(--space-4), 4vw, var(--space-6));
    box-shadow: var(--shadow-sm);
  }

  .dashboard-metrics {
    display: grid;
    gap: var(--space-4);
    grid-template-columns: repeat(auto-fit, minmax(14rem, 1fr));
  }

  .dashboard-metric {
    display: grid;
    gap: var(--space-2);
    padding: var(--space-4);
    border-radius: var(--radius-md);
    border: 1px solid rgba(230, 197, 71, 0.25);
  }

  .dashboard-metric[data-status="error"] { border-color: rgba(248, 113, 113, 0.45); }
  .dashboard-metric[data-status="warning"] { border-color: rgba(251, 191, 36, 0.45); }

  .metric-value {
    font-size: clamp(1.75rem, 3.4vw, 2.4rem);
    font-weight: var(--font-weight-bold);
  }

  .metric-label {
    color: var(--color-text-muted);
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-size: var(--font-size-sm);
  }

  .table-scroll { overflow-x: auto; }

  .monitor-table {
    width: 100%;
    border-collapse: collapse;
  }

  .monitor-table th,
  .monitor-table td {
    padding: var(--space-3);
    border-bottom: 1px solid rgba(148, 163, 184, 0.18);
    font-size: var(--font-size-sm);
    text-align: left;
  }

  .monitor-table th {
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--color-text-muted);
  }

  .status-badge {
    display: inline-flex;
    align-items: center;
    gap: var(--space-2);
  }

  .status-dot {
    width: 0.75rem;
    height: 0.75rem;
    border-radius: var(--radius-full);
    background: #38bdf8;
  }

  .status-dot.critical { background: #f87171; }
  .status-dot.warning { background: #fbbf24; }
  .status-dot.info { background: #38bdf8; }
</style>
{% endblock %}

{% block content %}
<section class="page-section">
  <div class="ds-container stack" style="gap: var(--space-5);">
    <header class="stack" style="gap: var(--space-2); text-align: center;">
      <span class="text-eyebrow">{% trans "Monitoring" %}</span>
      <h1 class="heading-display-lg">{% trans "Error Analytics" %}</h1>
      <p class="section-subheading">{% trans "Track critical incidents, warnings and info level messages at a glance." %}</p>
    </header>

    <section class="dashboard-panel">
      <h2 class="heading-title">{% trans "Summary" %}</h2>
      <div class="dashboard-metrics">
        <article class="dashboard-metric" data-status="error">
          <span class="metric-label">{% trans "Critical" %}</span>
          <span class="metric-value">{{ error_stats.critical_count }}</span>
        </article>
        <article class="dashboard-metric" data-status="warning">
          <span class="metric-label">{% trans "Warnings" %}</span>
          <span class="metric-value">{{ error_stats.warning_count }}</span>
        </article>
        <article class="dashboard-metric">
          <span class="metric-label">{% trans "Info" %}</span>
          <span class="metric-value">{{ error_stats.info_count }}</span>
        </article>
        <article class="dashboard-metric">
          <span class="metric-label">{% trans "Total Today" %}</span>
          <span class="metric-value">{{ error_stats.total_today }}</span>
        </article>
      </div>
    </section>

    <section class="dashboard-panel">
      <h2 class="heading-title">{% trans "Recent Errors" %}</h2>
      {% if recent_errors %}
        <div class="table-scroll">
          <table class="monitor-table">
            <thead>
              <tr>
                <th scope="col">{% trans "Level" %}</th>
                <th scope="col">{% trans "Message" %}</th>
                <th scope="col">{% trans "When" %}</th>
              </tr>
            </thead>
            <tbody>
              {% for error in recent_errors %}
                <tr>
                  <td>
                    <span class="status-badge">
                      <span class="status-dot {{ error.level|lower }}"></span>
                      {{ error.level }}
                    </span>
                  </td>
                  <td>{{ error.message|truncatechars:96 }}</td>
                  <td>{{ error.timestamp|timesince }} {% trans "ago" %}</td>
                </tr>
              {% endfor %}
            </tbody>
          </table>
        </div>
      {% else %}
        <p class="text-muted">{% trans "No recent errors found." %}</p>
      {% endif %}
    </section>
  </div>
</section>
{% endblock %}
