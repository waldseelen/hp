{% extends 'base.html' %} {% load static %} {% load i18n %} {% block title %}{% trans"Monitoring Dashboard" %} - {{ block.super }}{% endblock %} {% block extra_css %} <style> .dashboard-container { max-width: 1200px; margin: 0 auto; padding: 20px; } .dashboard-card { background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1); padding: 24px; margin-bottom: 24px; } .dashboard-header { display: flex; justify-content: between; align-items: center; margin-bottom: 30px; } .metric-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin-bottom: 30px; } .metric-card { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 20px; border-radius: 12px; position: relative; overflow: hidden; } .metric-card.success { background: linear-gradient(135deg, #4CAF50 0%, #45a049 100%); } .metric-card.warning { background: linear-gradient(135deg, #FF9800 0%, #F57C00 100%); } .metric-card.error { background: linear-gradient(135deg, #f44336 0%, #d32f2f 100%); } .metric-value { font-size: 2.5rem; font-weight: bold; margin-bottom: 8px; } .metric-label { font-size: 0.9rem; opacity: 0.9; } .chart-container { height: 400px; margin: 20px 0; } .refresh-btn { background: #667eea; color: white; border: none; padding: 10px 20px; border-radius: 6px; cursor: pointer; font-size: 14px; } .refresh-btn:hover { background: #5a6fd8; } .table-container { overflow-x: auto; } .table { width: 100%; border-collapse: collapse; margin-top: 20px; } .table th, .table td { text-align: left; padding: 12px; border-bottom: 1px solid #eee; } .table th { background: #f8f9fa; font-weight: 600; } .status-indicator { display: inline-block; width: 8px; height: 8px; border-radius: 50%; margin-right: 8px; } .status-success { background: #4CAF50; } .status-warning { background: #FF9800; } .status-error { background: #f44336; } .loading { text-align: center; padding: 40px; color: #666; } </style> {% endblock %} {% block content %} <div class="dashboard-container"> <div class="dashboard-header"> <h1>{% trans"System Monitoring Dashboard" %}</h1> <button class="refresh-btn" onclick="refreshDashboard()"> {% trans"Refresh" %} </button> </div> <!-- System Health Overview --> <div class="dashboard-card"> <h2>{% trans"System Health" %}</h2> <div class="metric-grid"> <div class="metric-card success"> <div class="metric-value" id="system-status">{% trans"Online" %}</div> <div class="metric-label">{% trans"System Status" %}</div> </div> <div class="metric-card"> <div class="metric-value" id="response-time">{{ avg_response_time|floatformat:2 }}ms</div> <div class="metric-label">{% trans"Avg Response Time" %}</div> </div> <div class="metric-card"> <div class="metric-value" id="total-requests">{{ total_requests }}</div> <div class="metric-label">{% trans"Total Requests (24h)" %}</div> </div> <div class="metric-card"> <div class="metric-value" id="error-rate">{{ error_rate|floatformat:1 }}%</div> <div class="metric-label">{% trans"Error Rate (24h)" %}</div> </div> </div> </div> <!-- Core Web Vitals --> <div class="dashboard-card"> <h2>{% trans"Core Web Vitals" %}</h2> <div class="chart-container"> <canvas id="webVitalsChart"></canvas> </div> <div class="metric-grid"> <div class="metric-card"> <div class="metric-value">{{ core_web_vitals.lcp|floatformat:2 }}s</div> <div class="metric-label">{% trans"Largest Contentful Paint (LCP)" %}</div> </div> <div class="metric-card"> <div class="metric-value">{{ core_web_vitals.fid|floatformat:0 }}ms</div> <div class="metric-label">{% trans"First Input Delay (FID)" %}</div> </div> <div class="metric-card"> <div class="metric-value">{{ core_web_vitals.cls|floatformat:3 }}</div> <div class="metric-label">{% trans"Cumulative Layout Shift (CLS)" %}</div> </div> <div class="metric-card"> <div class="metric-value">{{ core_web_vitals.inp|floatformat:0 }}ms</div> <div class="metric-label">{% trans"Interaction to Next Paint (INP)" %}</div> </div> </div> </div> <!-- Push Notifications --> <div class="dashboard-card"> <h2>{% trans"Push Notifications" %}</h2> <div class="metric-grid"> <div class="metric-card"> <div class="metric-value">{{ push_stats.total_subscriptions }}</div> <div class="metric-label">{% trans"Active Subscriptions" %}</div> </div> <div class="metric-card"> <div class="metric-value">{{ push_stats.notifications_sent_today }}</div> <div class="metric-label">{% trans"Sent Today" %}</div> </div> <div class="metric-card success"> <div class="metric-value">{{ push_stats.success_rate|floatformat:1 }}%</div> <div class="metric-label">{% trans"Delivery Success Rate" %}</div> </div> </div> </div> <!-- Recent Errors --> <div class="dashboard-card"> <h2>{% trans"Recent Errors" %}</h2> <div class="table-container"> <table class="table"> <thead> <tr> <th>{% trans"Level" %}</th> <th>{% trans"Message" %}</th> <th>{% trans"URL" %}</th> <th>{% trans"Count" %}</th> <th>{% trans"Last Occurred" %}</th> <th>{% trans"Status" %}</th> </tr> </thead> <tbody id="recent-errors"> {% for error in recent_errors %} <tr> <td> <span class="status-indicator status-{{ error.get_level_display|lower }}"></span> {{ error.get_level_display }} </td> <td>{{ error.message|truncatechars:50 }}</td> <td>{{ error.url|truncatechars:30 }}</td> <td>{{ error.occurrence_count }}</td> <td>{{ error.last_occurred|timesince }} {% trans"ago" %}</td> <td> {% if error.is_resolved %} <span class="status-indicator status-success"></span>{% trans"Resolved" %} {% else %} <span class="status-indicator status-error"></span>{% trans"Open" %} {% endif %} </td> </tr> {% empty %} <tr> <td colspan="6" class="loading">{% trans"No recent errors" %}</td> </tr> {% endfor %} </tbody> </table> </div> </div> <!-- Performance Trends --> <div class="dashboard-card"> <h2>{% trans"Performance Trends (7 Days)" %}</h2> <div class="chart-container"> <canvas id="performanceTrendChart"></canvas> </div> </div> </div> {% endblock %} {% block extra_js %} <script src="https://cdn.jsdelivr.net/npm/chart.js"></script> <script> let webVitalsChart, performanceTrendChart; document.addEventListener('DOMContentLoaded', function() { initializeCharts(); // Auto-refresh every 30 seconds setInterval(refreshDashboard, 30000); }); function initializeCharts() { // Core Web Vitals Chart const webVitalsCtx = document.getElementById('webVitalsChart').getContext('2d'); webVitalsChart = new Chart(webVitalsCtx, { type: 'doughnut', data: { labels: ['Good', 'Needs Improvement', 'Poor'], datasets: [{ data: [ {{ core_web_vitals.good_count }}, {{ core_web_vitals.needs_improvement_count }}, {{ core_web_vitals.poor_count }} ], backgroundColor: ['#4CAF50', '#FF9800', '#f44336'], borderWidth: 0 }] }, options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'bottom' }, title: { display: true, text: '{% trans"Performance Score Distribution" %}' } } } }); // Performance Trend Chart const performanceTrendCtx = document.getElementById('performanceTrendChart').getContext('2d'); performanceTrendChart = new Chart(performanceTrendCtx, { type: 'line', data: { labels: {{ performance_trend.dates|safe }}, datasets: [{ label: 'LCP (s)', data: {{ performance_trend.lcp_values|safe }}, borderColor: '#667eea', backgroundColor: 'rgba(102, 126, 234, 0.1)', tension: 0.4 }, { label: 'FID (ms)', data: {{ performance_trend.fid_values|safe }}, borderColor: '#764ba2', backgroundColor: 'rgba(118, 75, 162, 0.1)', tension: 0.4, yAxisID: 'y1' }] }, options: { responsive: true, maintainAspectRatio: false, interaction: { mode: 'index', intersect: false, }, scales: { y: { type: 'linear', display: true, position: 'left', title: { display: true, text: 'LCP (seconds)' } }, y1: { type: 'linear', display: true, position: 'right', title: { display: true, text: 'FID (milliseconds)' }, grid: { drawOnChartArea: false, }, } }, plugins: { legend: { position: 'top' } } } }); } async function refreshDashboard() { try { const response = await fetch('/api/performance/dashboard/'); const data = await response.json(); // Update metrics document.getElementById('response-time').textContent = data.avg_response_time.toFixed(2) + 'ms'; document.getElementById('total-requests').textContent = data.total_requests; document.getElementById('error-rate').textContent = data.error_rate.toFixed(1) + '%'; // Update charts updateCharts(data); console.log('Dashboard refreshed successfully'); } catch (error) { console.error('Failed to refresh dashboard:', error); } } function updateCharts(data) { // Update Web Vitals chart if (webVitalsChart) { webVitalsChart.data.datasets[0].data = [ data.core_web_vitals.good_count, data.core_web_vitals.needs_improvement_count, data.core_web_vitals.poor_count ]; webVitalsChart.update(); } // Update performance trend chart if (performanceTrendChart) { performanceTrendChart.data.labels = data.performance_trend.dates; performanceTrendChart.data.datasets[0].data = data.performance_trend.lcp_values; performanceTrendChart.data.datasets[1].data = data.performance_trend.fid_values; performanceTrendChart.update(); } } // Real-time updates via WebSocket (if available) if (typeof WebSocket !== 'undefined') { const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:'; const wsUrl = `${protocol}//${window.location.host}/ws/monitoring/`; try { const socket = new WebSocket(wsUrl); socket.onmessage = function(event) { const data = JSON.parse(event.data); if (data.type === 'dashboard_update') { updateDashboardData(data.payload); } }; socket.onclose = function() { console.log('WebSocket connection closed'); }; } catch (error) { console.log('WebSocket not available, using polling instead'); } } </script> {% endblock %}