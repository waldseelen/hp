{% extends "admin/base_site.html" %}
{% load i18n static %}

{% block title %}Account Locked | {{ block.super }}{% endblock %}
{% block bodyclass %}login-page lockout-page{% endblock %}

{% block content %}
<div class="lockout-container" data-admin-screen="lockout">
    <div class="lockout-card" role="alert" aria-live="polite">
        <div class="lockout-icon" aria-hidden="true">üîí</div>
        <h1 class="lockout-title">{% trans "Account Temporarily Locked" %}</h1>

        <p class="lockout-message">
            {% trans "Your account has been temporarily locked due to multiple failed login attempts. This is a security measure to protect your account." %}
        </p>

        <div class="lockout-countdown" data-ready-text="{% trans 'You can now try logging in again.' %}">
            <p id="countdown-text" data-countdown-minutes="{{ cooloff_time|default:0 }}">
                {% blocktrans with time=cooloff_time|floatformat:0 %}Please wait {{ time }} minutes before trying again.{% endblocktrans %}
            </p>
        </div>

        <section class="security-info" aria-label="{% trans 'Security Information' %}">
            <h3>üõ°Ô∏è {% trans "Security Information" %}</h3>
            <ul>
                <li><strong>{% trans "Failed attempts" %}</strong> <span>{{ failure_limit }}</span></li>
                <li><strong>{% trans "Lockout time" %}</strong> <span>{{ cooloff_time|floatformat:0 }} {% trans "minutes" %}</span></li>
                <li><strong>{% trans "Your IP" %}</strong> <span>{{ request.META.REMOTE_ADDR }}</span></li>
            </ul>
        </section>

        <p class="lockout-help-text">
            {% trans "If you believe this is an error or you're having trouble accessing your account, please contact the system administrator." %}
        </p>

        <a href="{{ login_url|default:'/admin/' }}" class="retry-btn">{% trans "Return to Login" %}</a>
    </div>
</div>

<script>
    (function () {
        const countdownElement = document.getElementById('countdown-text');
        if (!countdownElement) {
            return;
        }

        const readyText = countdownElement.parentElement?.dataset.readyText || 'You can now try logging in again.';
        const minutes = Number(countdownElement.dataset.countdownMinutes) || 0;
        if (!minutes) {
            countdownElement.textContent = readyText;
            countdownElement.classList.add('lockout-countdown__ready');
            return;
        }

        let time = minutes * 60;
        const timer = setInterval(() => {
            const mins = Math.floor(time / 60);
            const secs = Math.floor(time % 60);

            if (time > 0) {
                countdownElement.textContent = `Please wait ${mins}:${secs.toString().padStart(2, '0')} before trying again.`;
                time -= 1;
                return;
            }

            countdownElement.textContent = readyText;
            countdownElement.classList.add('lockout-countdown__ready');
            clearInterval(timer);
        }, 1000);
    })();
</script>
{% endblock %}

