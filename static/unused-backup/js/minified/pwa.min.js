const VERSION="1.1.0";class PWAManager{constructor(){this.version="1.1.0",this.swRegistration=null,this.pushSubscription=null,this.deferredPrompt=null,this.networkStatus=navigator.onLine,this.installAnalytics={prompted:!1,installed:!1,dismissed:!1},this.notificationPermission=Notification.permission,this.performanceObserver=null,this.init()}async init(){await this.initializeServiceWorker(),await this.initializePushNotifications(),this.initializePerformanceMonitoring(),this.handleInstallPrompt(),this.handleNetworkStatus(),this.initializeStorageManagement(),this.setupErrorHandling()}async initializeServiceWorker(){if("serviceWorker"in navigator)try{this.swRegistration=await navigator.serviceWorker.register("/static/js/sw.js",{scope:"/",updateViaCache:"none"}),this.swRegistration.addEventListener("updatefound",()=>{const t=this.swRegistration.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})}),navigator.serviceWorker.addEventListener("message",t=>{this.handleServiceWorkerMessage(t)}),this.setupUpdateCheck()}catch(t){this.logError("service_worker_registration",t)}}async initializePushNotifications(){if("PushManager"in window&&"Notification"in window)try{this.swRegistration&&(this.pushSubscription=await this.swRegistration.pushManager.getSubscription(),this.pushSubscription&&await this.syncPushSubscription()),this.setupNotificationPermission()}catch(t){this.logError("push_init",t)}}initializePerformanceMonitoring(){if("PerformanceObserver"in window)try{this.observeWebVitals(),this.observeResourcePerformance(),this.observeLongTasks()}catch(t){}}handleInstallPrompt(){window.addEventListener("beforeinstallprompt",t=>{t.preventDefault(),this.deferredPrompt=t,this.installAnalytics.prompted=!0,this.showInstallButton()}),window.addEventListener("appinstalled",t=>{this.installAnalytics.installed=!0,this.hideInstallButton(),this.logInstallEvent("installed")})}async subscribeToPushNotifications(t=[]){if(!this.swRegistration)throw new Error("Service Worker not available");try{if("granted"!==await Notification.requestPermission())throw new Error("Notification permission denied");const e=await fetch("/api/webpush/vapid-public-key/"),{publicKey:n}=await e.json();return this.pushSubscription=await this.swRegistration.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this.urlBase64ToUint8Array(n)}),await this.syncPushSubscription(t),this.pushSubscription}catch(t){throw this.logError("push_subscription",t),t}}async syncPushSubscription(t=[]){if(this.pushSubscription)try{const e=await fetch("/api/webpush/subscribe/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({subscription:this.pushSubscription.toJSON(),topics:t,user_agent:navigator.userAgent,url:window.location.href})});if(!e.ok)throw new Error(`Sync failed: ${e.status}`)}catch(t){this.logError("push_sync",t)}}async unsubscribeFromPushNotifications(){if(this.pushSubscription)try{const t=this.pushSubscription.endpoint;await this.pushSubscription.unsubscribe(),this.pushSubscription=null,await fetch("/api/webpush/unsubscribe/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({endpoint:t})})}catch(t){this.logError("push_unsubscribe",t)}}setupNotificationPermission(){"default"===Notification.permission&&this.showNotificationPrompt(),"permissions"in navigator&&navigator.permissions.query({name:"notifications"}).then(t=>{t.addEventListener("change",()=>{this.notificationPermission=t.state,"granted"===t.state&&this.hideNotificationPrompt()})})}showNotificationPrompt(){const t=document.createElement("div");t.className="pwa-notification-prompt",t.innerHTML='\n            <div class="notification-prompt-content">\n                <div class="prompt-icon">ðŸ””</div>\n                <div class="prompt-text">\n                    <h4>Stay Updated</h4>\n                    <p>Get notified about new blog posts and portfolio updates</p>\n                </div>\n                <button class="enable-notifications-btn">Enable Notifications</button>\n                <button class="dismiss-prompt-btn">Ã—</button>\n            </div>\n        ',t.style.cssText="\n            position: fixed;\n            top: 20px;\n            left: 50%;\n            transform: translateX(-50%);\n            background: white;\n            border-radius: 12px;\n            box-shadow: 0 8px 25px rgba(0,0,0,0.15);\n            z-index: 1003;\n            max-width: 400px;\n            animation: slideDown 0.3s ease;\n        ",this.addNotificationPromptStyles();const e=t.querySelector(".enable-notifications-btn"),n=t.querySelector(".dismiss-prompt-btn");e.addEventListener("click",async()=>{try{await this.subscribeToPushNotifications(["blog_posts","portfolio_updates"]),t.remove()}catch(t){}}),n.addEventListener("click",()=>{t.remove(),localStorage.setItem("pwa_notification_prompt_dismissed","true")}),localStorage.getItem("pwa_notification_prompt_dismissed")||(document.body.appendChild(t),setTimeout(()=>t.remove(),15e3))}hideNotificationPrompt(){const t=document.querySelector(".pwa-notification-prompt");t&&t.remove()}observeWebVitals(){new PerformanceObserver(t=>{const e=t.getEntries(),n=e[e.length-1];this.reportWebVital("lcp",n.startTime)}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(t=>{t.getEntries().forEach(t=>{this.reportWebVital("fid",t.processingStart-t.startTime)})}).observe({entryTypes:["first-input"]});let t=0;new PerformanceObserver(e=>{e.getEntries().forEach(e=>{e.hadRecentInput||(t+=e.value)}),this.reportWebVital("cls",t)}).observe({entryTypes:["layout-shift"]}),new PerformanceObserver(t=>{t.getEntries().forEach(t=>{this.reportWebVital("ttfb",t.responseStart-t.requestStart)})}).observe({entryTypes:["navigation"]})}observeResourcePerformance(){new PerformanceObserver(t=>{t.getEntries().forEach(t=>{t.duration>100&&this.reportResourcePerformance(t)})}).observe({entryTypes:["resource"]})}observeLongTasks(){"PerformanceObserver"in window&&new PerformanceObserver(t=>{t.getEntries().forEach(t=>{this.reportLongTask(t)})}).observe({entryTypes:["longtask"]})}async reportWebVital(t,e){try{await fetch("/api/performance/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({metric_type:t,value:e,url:window.location.href,user_agent:navigator.userAgent,viewport_size:`${window.innerWidth}x${window.innerHeight}`,connection_type:this.getConnectionType(),device_type:this.getDeviceType()})})}catch(t){}}async reportResourcePerformance(t){try{await fetch("/api/performance/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({metric_type:"resource_load",value:t.duration,url:t.name,additional_data:{resource_type:t.initiatorType,transfer_size:t.transferSize,encoded_size:t.encodedBodySize,decoded_size:t.decodedBodySize}})})}catch(t){}}async reportLongTask(t){try{await fetch("/api/performance/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({metric_type:"long_task",value:t.duration,url:window.location.href,additional_data:{start_time:t.startTime,attribution:t.attribution}})})}catch(t){}}showInstallButton(){if(document.querySelector(".pwa-install-btn"))return;const t=document.createElement("button");t.className="pwa-install-btn",t.innerHTML='\n            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/>\n                <polyline points="7,10 12,15 17,10"/>\n                <line x1="12" y1="15" x2="12" y2="3"/>\n            </svg>\n            Install App\n        ',t.addEventListener("click",async()=>{if(this.deferredPrompt)try{this.deferredPrompt.prompt();const{outcome:t}=await this.deferredPrompt.userChoice;this.logInstallEvent(t),"dismissed"===t&&(this.installAnalytics.dismissed=!0),this.deferredPrompt=null,this.hideInstallButton()}catch(t){}}),this.styleInstallButton(t),document.body.appendChild(t)}styleInstallButton(t){t.style.cssText="\n            position: fixed;\n            bottom: 20px;\n            right: 20px;\n            background: linear-gradient(135deg, #4f46e5, #7c3aed);\n            color: white;\n            border: none;\n            padding: 12px 20px;\n            border-radius: 50px;\n            font-weight: 600;\n            cursor: pointer;\n            box-shadow: 0 4px 15px rgba(79, 70, 229, 0.3);\n            z-index: 1000;\n            display: flex;\n            align-items: center;\n            gap: 8px;\n            transition: all 0.2s ease;\n        ",t.addEventListener("mouseenter",()=>{t.style.transform="translateY(-2px) scale(1.05)",t.style.boxShadow="0 6px 20px rgba(79, 70, 229, 0.4)"}),t.addEventListener("mouseleave",()=>{t.style.transform="translateY(0) scale(1)",t.style.boxShadow="0 4px 15px rgba(79, 70, 229, 0.3)"})}hideInstallButton(){const t=document.querySelector(".pwa-install-btn");t&&t.remove()}showUpdateNotification(){const t=document.createElement("div");t.className="pwa-update-notification",t.innerHTML='\n            <div class="update-content">\n                <div class="update-icon">ðŸ”„</div>\n                <div class="update-text">\n                    <strong>New update available!</strong>\n                    <p>Click to refresh and get the latest features</p>\n                </div>\n                <button class="update-btn" onclick="window.location.reload()">Update</button>\n                <button class="dismiss-btn" onclick="this.parentElement.parentElement.remove()">Ã—</button>\n            </div>\n        ',this.styleUpdateNotification(t),document.body.appendChild(t),setTimeout(()=>{t.parentElement&&t.remove()},15e3)}styleUpdateNotification(t){if(t.style.cssText="\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: white;\n            border-radius: 12px;\n            box-shadow: 0 8px 25px rgba(0,0,0,0.15);\n            z-index: 1001;\n            max-width: 350px;\n            animation: slideIn 0.3s ease;\n        ",!document.querySelector("#pwa-update-styles")){const t=document.createElement("style");t.id="pwa-update-styles",t.textContent="\n                @keyframes slideIn {\n                    from { transform: translateX(100%); opacity: 0; }\n                    to { transform: translateX(0); opacity: 1; }\n                }\n                .update-content {\n                    padding: 20px;\n                    display: flex;\n                    align-items: center;\n                    gap: 15px;\n                }\n                .update-icon {\n                    font-size: 24px;\n                    animation: rotate 2s linear infinite;\n                }\n                @keyframes rotate {\n                    from { transform: rotate(0deg); }\n                    to { transform: rotate(360deg); }\n                }\n                .update-text strong {\n                    color: #1f2937;\n                    font-size: 14px;\n                }\n                .update-text p {\n                    margin: 4px 0 0 0;\n                    color: #6b7280;\n                    font-size: 12px;\n                }\n                .update-btn {\n                    background: #4f46e5;\n                    color: white;\n                    border: none;\n                    padding: 8px 16px;\n                    border-radius: 6px;\n                    font-size: 12px;\n                    cursor: pointer;\n                    margin-left: auto;\n                    transition: background 0.2s;\n                }\n                .update-btn:hover {\n                    background: #4338ca;\n                }\n                .dismiss-btn {\n                    background: none;\n                    border: none;\n                    font-size: 20px;\n                    cursor: pointer;\n                    color: #9ca3af;\n                    margin-left: 8px;\n                    transition: color 0.2s;\n                }\n                .dismiss-btn:hover {\n                    color: #6b7280;\n                }\n            ",document.head.appendChild(t)}}handleNetworkStatus(){const t=t=>{this.networkStatus=t;const e=document.querySelector(".network-status")||document.createElement("div");e.className="network-status",e.style.cssText=`\n                position: fixed;\n                top: 0;\n                left: 0;\n                right: 0;\n                padding: 12px 16px;\n                text-align: center;\n                font-size: 14px;\n                font-weight: 600;\n                z-index: 1002;\n                transition: transform 0.3s ease;\n                ${t?"background: linear-gradient(135deg, #10b981, #059669); color: white; transform: translateY(-100%);":"background: linear-gradient(135deg, #ef4444, #dc2626); color: white; transform: translateY(0);"}\n            `,e.innerHTML=t?"ðŸŸ¢ Back online - Syncing data...":"ðŸ”´ You're offline - Using cached content",document.querySelector(".network-status")||document.body.appendChild(e),t&&(this.syncOfflineData(),setTimeout(()=>{e.style.transform="translateY(-100%)",setTimeout(()=>e.remove(),300)},3e3))};window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)),navigator.onLine||t(!1)}async syncOfflineData(){if("serviceWorker"in navigator&&navigator.serviceWorker.controller)try{const t=await navigator.serviceWorker.ready;await Promise.all([t.sync.register("performance-metrics"),t.sync.register("error-logs"),t.sync.register("contact-form")])}catch(t){}}async initializeStorageManagement(){if("storage"in navigator&&"estimate"in navigator.storage)try{const t=await navigator.storage.estimate();Math.round(t.usage/1024/1024),Math.round(t.quota/1024/1024),"persist"in navigator.storage&&await navigator.storage.persist(),this.monitorStorageUsage()}catch(t){}}async monitorStorageUsage(){setInterval(async()=>{try{const t=await navigator.storage.estimate();t.usage/t.quota*100>80&&this.cleanupOldCache()}catch(t){}},3e5)}async cleanupOldCache(){try{const t=(await caches.keys()).filter(t=>!t.includes(`portfolio-v${this.version}`)&&t.includes("portfolio-"));await Promise.all(t.map(t=>caches.delete(t)))}catch(t){}}setupUpdateCheck(){document.addEventListener("visibilitychange",()=>{!document.hidden&&this.swRegistration&&this.swRegistration.update()}),setInterval(()=>{this.swRegistration&&!document.hidden&&this.swRegistration.update()},6e5)}setupErrorHandling(){window.addEventListener("error",t=>{this.logError("javascript_error",{message:t.message,filename:t.filename,lineno:t.lineno,colno:t.colno,stack:t.error?.stack})}),window.addEventListener("unhandledrejection",t=>{this.logError("unhandled_promise_rejection",{reason:t.reason,promise:t.promise})})}handleServiceWorkerMessage(t){const{data:e}=t;e.type}addNotificationPromptStyles(){if(!document.querySelector("#pwa-notification-styles")){const t=document.createElement("style");t.id="pwa-notification-styles",t.textContent="\n                @keyframes slideDown {\n                    from { transform: translate(-50%, -100%); opacity: 0; }\n                    to { transform: translate(-50%, 0); opacity: 1; }\n                }\n                .notification-prompt-content {\n                    padding: 20px;\n                    display: flex;\n                    align-items: center;\n                    gap: 15px;\n                    position: relative;\n                }\n                .prompt-icon {\n                    font-size: 24px;\n                    animation: pulse 2s infinite;\n                }\n                @keyframes pulse {\n                    0%, 100% { transform: scale(1); }\n                    50% { transform: scale(1.1); }\n                }\n                .prompt-text h4 {\n                    margin: 0 0 4px 0;\n                    color: #1f2937;\n                    font-size: 16px;\n                }\n                .prompt-text p {\n                    margin: 0;\n                    color: #6b7280;\n                    font-size: 14px;\n                }\n                .enable-notifications-btn {\n                    background: #4f46e5;\n                    color: white;\n                    border: none;\n                    padding: 10px 16px;\n                    border-radius: 6px;\n                    font-size: 14px;\n                    cursor: pointer;\n                    margin-left: auto;\n                    transition: background 0.2s;\n                }\n                .enable-notifications-btn:hover {\n                    background: #4338ca;\n                }\n                .dismiss-prompt-btn {\n                    position: absolute;\n                    top: 10px;\n                    right: 10px;\n                    background: none;\n                    border: none;\n                    font-size: 20px;\n                    cursor: pointer;\n                    color: #9ca3af;\n                    width: 24px;\n                    height: 24px;\n                    display: flex;\n                    align-items: center;\n                    justify-content: center;\n                }\n                .dismiss-prompt-btn:hover {\n                    color: #6b7280;\n                    background: #f3f4f6;\n                    border-radius: 50%;\n                }\n            ",document.head.appendChild(t)}}async logError(t,e){try{await fetch("/api/errors/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({error_type:t,level:"error",message:e.message||String(e),stack_trace:e.stack||"",url:window.location.href,user_agent:navigator.userAgent,additional_data:e})})}catch(t){}}async logInstallEvent(t){try{await fetch("/api/pwa/install/",{method:"POST",headers:{"Content-Type":"application/json","X-CSRFToken":this.getCSRFToken()},body:JSON.stringify({outcome:t,analytics:this.installAnalytics,user_agent:navigator.userAgent,url:window.location.href})})}catch(t){}}getCSRFToken(){return document.querySelector("[name=csrfmiddlewaretoken]")?.value||document.querySelector("meta[name=csrf-token]")?.content||""}urlBase64ToUint8Array(t){const e=(t+"=".repeat((4-t.length%4)%4)).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(e);return new Uint8Array([...n].map(t=>t.charCodeAt(0)))}getConnectionType(){return navigator.connection?.effectiveType||"unknown"}getDeviceType(){const t=window.innerWidth;return t<768?"mobile":t<1024?"tablet":"desktop"}async enableNotifications(t=[]){return await this.subscribeToPushNotifications(t)}async disableNotifications(){return await this.unsubscribeFromPushNotifications()}getInstallStatus(){return{canInstall:!!this.deferredPrompt,isInstalled:this.installAnalytics.installed,wasPrompted:this.installAnalytics.prompted}}getNetworkStatus(){return this.networkStatus}async getStorageInfo(){return"storage"in navigator&&"estimate"in navigator.storage?await navigator.storage.estimate():null}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{new PWAManager}):new PWAManager;
//# sourceMappingURL=pwa.min.js.map
//# sourceMappingURL=pwa.min.js.map